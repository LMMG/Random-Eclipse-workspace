package gg.vexus.listeners;

import org.bukkit.Bukkit;
import org.bukkit.Material;
import org.bukkit.entity.LivingEntity;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.entity.EntityDamageByEntityEvent;
import org.bukkit.event.entity.EntityDeathEvent;
import org.bukkit.event.player.PlayerDropItemEvent;
import org.bukkit.event.player.PlayerItemHeldEvent;
import org.bukkit.inventory.ItemStack;

import net.md_5.bungee.api.ChatColor;

public class BookExploit implements Listener {
	
	@EventHandler 
	public void onItemHeld(PlayerItemHeldEvent event) {
		ItemStack item = event.getPlayer().getItemInHand();
		if (item != null) {
			if (item.hasItemMeta() && item.getEnchantments().values().size() > 0 && item.getType() == Material.BOOK_AND_QUILL) {
				for (Player on : Bukkit.getOnlinePlayers()) {
					if (on.isOp()) {
						on.sendMessage(ChatColor.RED + event.getPlayer().getName() + "'s has an Expliot Book.");
					}
				}
			}
		}
	}
	
	@EventHandler
	public void onDrop(PlayerDropItemEvent event) {
		ItemStack item = event.getItemDrop().getItemStack();
		if (item != null) {
			if (item.hasItemMeta() && item.getEnchantments().values().size() > 0 && item.getType() == Material.BOOK_AND_QUILL) {
				event.setCancelled(true);
				event.getItemDrop().remove();
			}
		}
	}
	
	@EventHandler
	public void onDamage(EntityDeathEvent event) {
		if (event.getEntity() instanceof LivingEntity) {
			if (event.getDrops().size() > 40) {
				event.getDrops().clear();
			}
		}
	}
	
	@EventHandler
	public void onAttack(EntityDamageByEntityEvent event) {
		if (event.getDamager() instanceof Player) {
			Player attacker = (Player) event.getDamager();
			ItemStack item = attacker.getItemInHand();
			if (item != null) {
				if (item.hasItemMeta() && item.getEnchantments().values().size() > 0 && item.getType() == Material.BOOK_AND_QUILL) {
					for (Player on : Bukkit.getOnlinePlayers()) {
						if (on.isOp()) {
							on.sendMessage(ChatColor.RED + attacker.getName() + "'s has an Expliot Book.");
						}
					}
					event.setCancelled(true);
				}
			}
		}
	}

}